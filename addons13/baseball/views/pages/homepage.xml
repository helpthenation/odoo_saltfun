<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

  <template id="homepage" name="Homepage" inherit_id="website.homepage">
  <xpath expr="//div[@id='wrap']" position="inside">
  <div class="oe_structure">
    <div class="container">
      <div class='row'>
        <div class="col-lg-5">
          <div class="panel panel-default">
            <div class="panel-heading"><h3 class="panel-title">Prochains matches</h3></div>
            <div class="panel-body">
              <t t-call="baseball.5upcoming_games"/>
                <div class="text-center">
                  <a class="btn btn-default" href="/page/upcoming_games">Tous les matches <i class="fa fa-calendar"/></a>
                  <a class="btn btn-default" t-att-href="'http://www.google.com/calendar/render?cid=%s/baseball/calendar/%s/all.ics' % (request.env['ir.config_parameter'].sudo().get_param('web.base.url'), request.env.ref('baseball.home_venue').id)">
                    <i class="fa fa-google"/> Subscribe at <span t-esc="request.env.ref('baseball.home_venue').name"/> events <i class="fa fa-calendar"/>
                  </a>
                </div>
            </div>
          </div>
        </div>
        <div class="col-lg-7">
          <div class="panel panel-default">
            <div class="panel-heading"><h3 class="panel-title">Nouvelles</h3></div>
            <div class="panel-body">
              <t t-call="baseball.news"/>
            </div>
          </div>
        </div>
      </div>
    </div>
  <div class="oe_structure mb32"/>
  </div>
</xpath>
</template>

<template id="news" name="News">
  <t t-set="blog_posts" t-value="request.env['blog.post'].search([], limit=5)"/>
  <div t-foreach="blog_posts" t-as="blog_post">
    <span t-field="blog_post.author_avatar" t-field-options='{"widget": "image", "class": "img-circle pull-right media-object img-avatar"}' />
    <a t-attf-href="/blog/#{ slug(blog_post.blog_id) }/post/#{ slug(blog_post) }">
        <h4 t-field="blog_post.name" class="mb4"/>
    </a>
    <div class="text-muted">
      <div name='blog_post_data' class='mb0' style="font-size: smaller;">
           <span t-field="blog_post.author_id" style="display: inline-block;" t-field-options='{
                  "widget": "contact",
                  "fields": ["name"]
              }'/>
          &#5760; <span t-field="blog_post.create_date" t-field-options='{"format": "MMMM yyyy"}'/>
          <span t-if="not blog_post.website_published" class="label label-danger">not published</span>
      </div>
    </div>
  </div>
</template>

<template id="5upcoming_games" name="Upcoming games">
      <t t-set="games" t-value="request.env['baseball.game'].sudo()._get_upcoming_games(limit=5)"/>
      <table class="table table-condensed data_calendar_table">
        <thead>
          <tr>
            <th class="col-md-4">Date</th>
            <th class="col-md-3">Division</th>
            <th class="col-md-2">Home</th>
            <!-- <th></th> -->
            <!-- <th></th> -->
            <th class="col-md-2">Away</th>
            <th class="col-md-4">Heure</th>
          </tr>
        </thead>
        <tbody>
          <t t-foreach="games" t-as="game">
            <t t-if="game.game_type != 'tournament'">
              <tr class="js_game" t-attf-id="#{game.id}" t-att-style="'font-style: italic;' if game.game_type == 'friendly' else ''">
                <td><span t-field="game.start_time" t-field-options='{"format": "dd/MM/yy"}'/></td>
                <td><span t-field="game.division.name"/></td>
                <!-- <td><span t-field="game.home_team.name"/></td> -->
                <td>
                  <t t-if="game.home_team.logo_id and game.home_team.logo_id.image" >
                    <img class="maxed img img-responsive img-circle" style="width: 25px" t-att-src="'data:image/png;base64,'+game.home_team.logo_id.sudo().image"/>
                  </t>
                </td>
                <td>
                  <t t-if="game.away_team.logo_id and game.away_team.logo_id.image" >
                    <img class="maxed img img-responsive img-circle" style="width: 25px" t-att-src="'data:image/png;base64,'+game.away_team.logo_id.sudo().image"/>
                  </t>
                </td>          
                <!-- <td><span t-field="game.away_team.name"/></td> -->
                <td><span t-field="game.start_time" t-field-options='{"format": "HH:mm"}'/></td>               
              </tr>
            </t>
          </t>
        </tbody>
      </table>
</template>


  </data>
</odoo>
